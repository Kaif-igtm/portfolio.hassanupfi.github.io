"use strict";!function(){if("function"==typeof NodeList.prototype.forEach)return;NodeList.prototype.forEach=Array.prototype.forEach}();var hostedPaymentFields=function(){var n,o,e,t,a,i=!0,c="https://songbirdstag.cardinalcommerce.com/edge/v1/songbird.js",l={token:"",style:{},ccnPlaceHolder:"Card number",cvvPlaceHolder:"CVC/CVV",expPlaceHolder:"MM/YY",expDropDownSelector:!1},s={hostedPaymentFields:{},onFieldEventHandler:{}},d={"3DS":!1},u={"3DS":{}},p=[],h=!1,v=!1,f=!1,m="",g="",y=!0,b={cvv:!1,ccn:!1,exp:!1,responseJSON:{},onCallBackResponse:function(e){I("dataObj: "+JSON.stringify(e));var t=e.tagId;if(this[t]=!0,"success"===e.eventType){var a=e.param;if(null!==this.responseJSON.cardData&&void 0!==this.responseJSON.cardData||(this.responseJSON.cardData={}),"ccn"===t){var r=JSON.parse(a);this.responseJSON.cardData.ccType=r.ccType,this.responseJSON.cardData.last4Digits=r.last4Digits,this.responseJSON.cardData.issuingCountry="Planet Earth";try{null!=r.issuingCountry&&(this.responseJSON.cardData.issuingCountry=r.issuingCountry),null!=r.isRegulatedCard&&(this.responseJSON.cardData.isRegulatedCard=r.isRegulatedCard),null!=r.cardSubType&&(this.responseJSON.cardData.cardSubType=r.cardSubType),null!=r.binCategory&&(this.responseJSON.cardData.binCategory=r.binCategory),null!=r.ccBin&&(this.responseJSON.cardData.ccBin=r.ccBin)}catch(e){I("JSON error, "+e)}}"exp"===t&&(this.responseJSON.cardData.exp=a)}else"error"===e.eventType?(null!==this.responseJSON.error&&void 0!==this.responseJSON.error||(this.responseJSON.error=[]),this.responseJSON.error[this.responseJSON.error.length]={tagId:t,errorCode:e.errorCode,errorDescription:e.errorDescription,eventType:e.eventType}):I("put error");if(this.cvv&&this.ccn&&this.exp&&this.callback)if(I("All three iFrames finished"),!0===d["3DS"]&&0<Object.keys(u["3DS"]).length&&(null===this.responseJSON.error||void 0===this.responseJSON.error)){var n=this.responseJSON.cardData.ccBin;try{var o=m.split(".")[1];JSON.parse(decodeURIComponent(escape(atob(o)))).exp;this._utcMilliSecondsExpirationDate<Date.now()+3e5?N({tagId:"ccn",event:"updateJwt"}):S(n)}catch(e){I("JWT decode failed"),S(n)}}else void 0!==this.responseJSON.error&&(this.responseJSON.cardData=null),this.callback(this.responseJSON),this.cvv=!1,this.ccn=!1,this.exp=!1,this.responseJSON={}},setCallBack:function(e){this.ccn=p.indexOf("ccn")<0,this.cvv=p.indexOf("cvv")<0,this.exp=p.indexOf("exp")<0,this.callback=e},set3DSAuthenticationResult:function(e){var t={};t.authResult=e,null!=g&&""!==g&&(t.threeDSecureReferenceId=g),this.responseJSON.threeDSecure=t,this.callback(this.responseJSON)}};function S(e){"undefined"!=typeof Cardinal&&e?(I("activate Cardinal Bin Process"),Cardinal.trigger("bin.process",e).then(function(e){e.Status?I("Bin profiling was successful."):I("Bin profiling failed."),N({tagId:"ccn",event:"authenticateWith3DS",threeDSecureFields:u["3DS"],jwt:m})}).catch(function(e){I("An error occurred during Bin profiling."),N({tagId:"ccn",event:"authenticateWith3DS",threeDSecureFields:u["3DS"],jwt:m})})):(I("Cardinal Bin Process was not activated"),N({tagId:"ccn",event:"authenticateWith3DS",threeDSecureFields:u["3DS"],jwt:m}))}function D(){return"_"!==l.token.slice(-1)}function r(){try{this.ccn=C("ccn"),this.cvv=C("cvv"),this.exp=C("exp")}catch(e){console.log("Missing IFrame id, "+e)}}function C(e){return s.hostedPaymentFields.hasOwnProperty(e)?document.querySelector("[data-bluesnap="+s.hostedPaymentFields[e]+"]"):null}function w(e){var t=new r,a={ccn:t.ccn,cvv:t.cvv,exp:t.exp};try{return a[e]}catch(e){console.log("this is not a valid id, "+e)}}function A(){var t="";try{t=(D()&&(n="https://www"+l.token.slice(-1)+".bluesnap.com/source/web-sdk/hosted-payment-fields/bluesnap.iframe.html#"),n)}catch(e){I("cannot retreive domain, "+e)}try{p.forEach(function(e){w(e).innerHTML=function(e,t){var a=document.location.origin;return"<iframe frameborder='0' style='border: medium none; width: 100%; height: 100%; float: left;' src='"+(t+=window.btoa(a+e+("exp"===e&&l.expDropDownSelector?"_":"")))+"' allowtransparency='true' scrolling='no' type="+e+" name='bluesnap-hosted-iframe-"+e+"' id='bluesnap-hosted-iframe-"+e+"'></iframe>"}(e,t),"exp"===e&&document.querySelector("#bluesnap-hosted-iframe-exp").setAttribute("bluesnapselect",l.expDropDownSelector)})}catch(e){I("cannot create iframes, "+e)}}function O(e){"put"===e.event?b.onCallBackResponse(e):"cc-exp"===e.event?N({tagId:"exp",event:e.event,value:e.value}):k(e)}function k(e){try{var t="on"+function(e){return e.charAt(0).toUpperCase()+e.slice(1)}(e.event);switch(t){case"onError":s.onFieldEventHandler[t](e.tagId,e.errorCode,e.errorDescription);break;case"onType":if(null!=e.cardType)s.onFieldEventHandler[t](e.tagId,e.cardType);else if(null!=e.cardData){try{var a=JSON.parse(e.cardData);null==a.issuingCountry&&(a.issuingCountry="Planet Earth")}catch(e){I("JSON error, "+e)}s.onFieldEventHandler[t](e.tagId,function(e){return{VISA:"Visa",MASTERCARD:"MasterCard",AMEX:"AmericanExpress",DISCOVER:"Discover",DINERS:"DinersClub",JCB:"JCB",CHINA_UNION_PAY:"ChinaUnionPay",SOLO:"Solo",CARTE_BLEUE:"CarteBleue",MAESTROUK:"MaestroUK",ARGENCARD:"ArgenCard",CABAL:"Cabal",TARJETASHOPPING:"TarjetaShopping",NARANJA:"Naranja",CENCOSUD:"Cencosud",HIPERCARD:"HiperCard",ELO:"Elo"}[e]}(a.ccType),a)}break;default:s.onFieldEventHandler[t](e.tagId)}}catch(e){console.log("onFieldEventHandler is not valid, "+e)}}function N(e){var t=w(e.tagId).querySelectorAll("iframe[id^='bluesnap-hosted-iframe-']")[0].contentWindow;I("iFrameUrl: "+n),t.postMessage(JSON.stringify(e),n.split("/source/")[0])}function J(e,t,a){I("Posting "+e+" message to iFrames");var r={event:e};null!=a&&(r[t]=a),p.forEach(function(e){r.tagId=e,N(r)})}function E(){null!=o&&(I("Enabling the submit button"),o.disabled=!1)}function I(e){!1===i&&console.log("BS.Main: "+e)}function x(){var e=l.token;return(function(){var e=l.token;return 67<e.length&&/^[a-zA-Z0-9_-]+[\.][a-zA-Z0-9_-]+[\.][a-zA-Z0-9_-]+[\.](_|_1|_2)$/.test(e)}()?e.split(".")[2]:e).replaceAll("-","").substring(0,32)}e=window,t="message",a=function(e){if(e.origin===n.split("/source/")[0]){var t="";if(e.data)try{t=JSON.parse(e.data)}catch(e){I("JSON parse error, "+e)}if("implementation"===t.event)I("Received implementation message from iFrame ["+t.tagId+"]"),I("Posting implementation message back to iFrame ["+t.tagId+"]"),N({tagId:t.tagId,event:"implementation",tokenAndStyle:l}),!0===d["3DS"]&&!1===v&&!1===h&&(I("Jwt wasn't created nor sent. Posting createJwt message to iFrame ["+t.tagId+"]"),h=!0,null==m||""===m?N({tagId:t.tagId,event:"createJwt"}):(v=!0,P.activateCardinalSetup(m)));else if("cardinalSetup"===t.event||"updateJwt"===t.event){if(I("Received "+t.event+" message from internal.js. Setting jwtCreated = true"),v=!0,m=t.jwt,null!==t.threeDSecureReferenceId&&void 0!==t.threeDSecureReferenceId&&""!==t.threeDSecureReferenceId&&(g=t.threeDSecureReferenceId),"cardinalSetup"===t.event)P.activateCardinalSetup(m);else S(this.responseJSON.cardData.ccBin)}else if("cardinalContinue"===t.event){I("Received cardinalContinue message from internal.js");var a=t.enrollmentData,r=a.enrollmentStatus;"CHALLENGE_REQUIRED"===r?function(e){I("Calling Cardinal.continue");var t={AcsUrl:e.acsUrl,Payload:e.payload},a={OrderDetails:{TransactionId:e.transactionId}};Cardinal.continue("cca",t,a)}(a):(I("enrollmentStatus = "+r),b.set3DSAuthenticationResult(r))}else"authenticationResult"===t.event?(I("Received authenticationResult message from internal.js"),!0===y&&b.set3DSAuthenticationResult(t.authResult)):O(t)}},e.addEventListener?e.addEventListener(t,a,!1):e.attachEvent?e.attachEvent("on"+t,a):e["on"+t]=a;var P={isCardinal:!1,needToActivateCardinalSetup:!1,cardinalSetupAlreadyActivated:!1,tempData:"",activateCardinalSetup:function(e){this.tempData=e,this.isCardinal?(this.cardinalSetupAlreadyActivated?I("Already Activated JWT"):(function(e){I("Calling Cardinal.setup"),Cardinal.setup("init",{jwt:e})}(this.tempData),I("Activating cardinalSetup")),this.tempData="",this.needToActivateCardinalSetup=!1):(I("Cardinal Script Load is not Done, Need To Activate Cardinal Setup"),this.needToActivateCardinalSetup=!0)}};function R(e,t){var a=document.createElement("script");a.type="text/javascript",a.src=e,a.onreadystatechange=t,a.onload=t,document.head.appendChild(a)}function T(e,t){I("Posting processAuthenticationResult message to iFrame[ccn]"),N({tagId:"ccn",event:"processAuthenticationResult",jwt:m,resultJwt:e,data:t})}return{submitCredentials:function(e,t){b.setCallBack(e);var a=function(e){if(!0===d["3DS"]&&y){var t=e.amount,a=e.currency,r="";if("number"!=typeof t&&"string"!=typeof a?r=" { amount, currency }":"number"!=typeof t?r=" { amount }":"string"!=typeof a&&(r=" { currency }"),""!==r)return{tagId:"ccn",event:"error",errorCode:"14102",errorDescription:"3D Secure object is missing required fields"+r};u["3DS"]=e}}(t);void 0===a?J("put"):O(a)},hostedPaymentFieldsCreation:function(e,t,a){n=t+"/source/web-sdk/hosted-payment-fields/bluesnap.iframe.html#",p=[],a.hostedPaymentFields={},document.querySelectorAll("[data-bluesnap]").forEach(function(e){var t=e.getAttribute("data-bluesnap");"submitButton"===t?o=e:"ccn"!==t&&"cvv"!==t&&"exp"!==t||(p[p.length]=t,a.hostedPaymentFields[t]=t)});var r=function(e,t){var a={styles:["appearance","-webkit-appearance","-webkit-appearance","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","right","top","bottom","display","position","padding","padding-top","padding-right","padding-bottom","padding-left","margin","margin-top","margin-right","margin-bottom","margin-left","color","font","font-family","font-size","font-style","font-weight","line-height","opacity","outline","text-shadow","transition","left","margin-right","width","height","background-color","background-image","background-repeat","background-size","background-position","background-origin"],fields:["#ccn","#ccn:focus","#ccn.valid","#ccn.invalid","#cvv","#cvv:focus","#cvv.valid","#cvv.invalid","#year","#year:focus","#year.valid","#year.invalid","#month","#month:focus","#month.valid","#month.invalid","input","::placeholder","::-webkit-input-placeholder","::-moz-placeholder",":-ms-input-placeholder",":-moz-placeholder",":focus",".valid",".invalid",".valid:focus",".invalid:focus","span","select","option","select#month","select#year","#month::placeholder","#month::-webkit-input-placeholder","#month::-moz-placeholder","#month:-ms-input-placeholder","#month:-moz-placeholder","#year::placeholder","#year::-webkit-input-placeholder","#year::-moz-placeholder","#year:-ms-input-placeholder","#year:-moz-placeholder",":focus::placeholder",":focus::-webkit-input-placeholder",":focus::-moz-placeholder",":focus:-ms-input-placeholder",":focus:-moz-placeholder","#ccn:focus::placeholder","#ccn:focus::-webkit-input-placeholder","#ccn:focus::-moz-placeholder","#ccn:focus:-ms-input-placeholder","#ccn:focus:-moz-placeholder","#cvv:focus::placeholder","#cvv:focus::-webkit-input-placeholder","#cvv:focus::-moz-placeholder","#cvv:focus:-ms-input-placeholder","#cvv:focus:-moz-placeholder","#month:focus::placeholder","#month:focus::-webkit-input-placeholder","#month:focus::-moz-placeholder","#month:focus:-ms-input-placeholder","#month:focus:-moz-placeholder","#year:focus::placeholder","#year:focus::-webkit-input-placeholder","#year:focus::-moz-placeholder","#year:focus:-ms-input-placeholder","#year:focus:-moz-placeholder"]};if("object"!=typeof e.style||null===e.style)return[!0,"not an object"];for(var r in e.style){if(-1===a.fields.indexOf(r))return[!1,"error"];for(var n in e.style[r]){if(-1===a.styles.indexOf(n))return[!1,"error"];"background-image"===n&&(console.log("background-image"),console.log(e.style[r]),e.style[r]["background-image"]="url("+t+e.style[r]["background-image"]+")",console.log(e.style[r])),"border-image"===n&&(console.log("border-image"),console.log(e.style[r]),e.style[r]["border-image"]="url("+t+e.style[r]["border-image"]+")",console.log(e.style[r]))}}return[!0,"object"]}(a,t);r[0]?("object"===r[1]?l.style=a.style:delete l.style,l.token=e,void 0!==a.ccnPlaceHolder&&null!==a.ccnPlaceHolder&&(l.ccnPlaceHolder=a.ccnPlaceHolder),void 0!==a.cvvPlaceHolder&&null!==a.cvvPlaceHolder&&(l.cvvPlaceHolder=a.cvvPlaceHolder),void 0!==a.expPlaceHolder&&null!==a.expPlaceHolder&&(l.expPlaceHolder=a.expPlaceHolder),void 0!==a.expDropDownSelector&&null!==a.expDropDownSelector&&(l.expDropDownSelector=a.expDropDownSelector),void 0!==a["3DS"]&&null!==a["3DS"]?!0===a["3DS"]&&(d["3DS"]=!0,null!=o&&(o.disabled=!0),P.cardinalSetupAlreadyActivated&&P.isCardinal?(h=v=!1,Cardinal.off("payments.setupComplete"),E(),Cardinal.off("payments.validated"),Cardinal.on("payments.validated",function(e,t){I("payments.validated callback was called"),I(JSON.stringify(e)),null==t&&(y=!1,k({tagId:null,event:"error",errorCode:"14103",errorDescription:"3D Secure client error"}),E()),T(t,e)})):(D()&&(c="https://songbird.cardinalcommerce.com/edge/v1/songbird.js"),I("Loading cardinalcruise js"),R(c,function(){var e="off";!1===i&&(e="on"),Cardinal.configure({logging:{level:e}}),Cardinal.on("payments.setupComplete",function(){I("payments.setupComplete callback was called"),P.cardinalSetupAlreadyActivated=!0,E()}),Cardinal.on("payments.validated",function(e,t){I("payments.validated callback was called"),I(JSON.stringify(e)),null==t&&(y=!1,k({tagId:null,event:"error",errorCode:"14103",errorDescription:"3D Secure client error"}),E()),T(t,e)}),P.isCardinal=!0,P.needToActivateCardinalSetup&&(I("Need To Activate Cardinal Setup"),P.activateCardinalSetup(P.tempData))}))):E(),s.hostedPaymentFields=a.hostedPaymentFields,s.onFieldEventHandler=a.onFieldEventHandler,A(),f||R((D()?"https://ssl.kaptcha.com":"https://tst.kaptcha.com")+"/collect/sdk?m=700000&s="+x(),function(){document.body.classList.add("kaxsdc"),document.body.setAttribute("data-event","load");var e=new ka.ClientSDK;e.setupCallback({"collect-end":function(e){I("collect-end")},"collect-begin":function(e){I("collect-begin")}}),e.autoLoadEvents(),f=!0})):console.log(r[1]+" check style did not pass")},updateBSToken:function(e){J("updateBSToken","token",l.token=e)},change3dsActivation:function(e){v&&h||d["3DS"]?d["3DS"]=e:I("3DS initialization was not activated")}}}();